name: Daily Horoscopes Commit

on:
  schedule:
    - cron: '0 0 * * *'   # 每天 UTC 00:00（北京时间 08:00
  workflow_dispatch:

jobs:
  commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repo
        uses: actions/checkout@v4

      - name: Generate mystic quote and fortune and append to README
        run: |
          # 加载64卦数据 (这里假设yijing_64gua.json存放在仓库的根目录)
          HEXAGRAMS=$(cat yijing_64gua.json)

          # 随机选择一卦 (0-63)
          HEXAGRAM_INDEX=$(( RANDOM % 64 ))
          
          # 获取选中的卦信息
          HEXAGRAM=$(echo "$HEXAGRAMS" | jq -r ".[$HEXAGRAM_INDEX]")
          SYMBOL=$(echo "$HEXAGRAM" | jq -r '.symbol')
          NAME=$(echo "$HEXAGRAM" | jq -r '.name')
          TEXT=$(echo "$HEXAGRAM" | jq -r '.text')
          IMAGE=$(echo "$HEXAGRAM" | jq -r '.image')
          INTERPRETATION=$(echo "$HEXAGRAM" | jq -r '.interpretation')

          DATE=$(date '+%Y-%m-%d')

          # 将选中的卦信息添加到 README.md 文件
          echo "" >> README.md
          echo "### 🌌 今日卦象 ($DATE)" >> README.md
          echo "卦象: $SYMBOL $NAME" >> README.md
          echo "卦辞: $TEXT" >> README.md
          echo "大象: $IMAGE" >> README.md
          echo "启示: $INTERPRETATION" >> README.md
          echo "" >> README.md

      - name: Commit and push changes
        env:
          TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name "CYXNBNBNB"
          git config --global user.email "cyxnbnbnb@gmail.com"
          git remote set-url origin https://x-access-token:${TOKEN}@github.com/${{ github.repository }}
          git add README.md
          git commit -m "🌌 Mystic update on $(date '+%Y-%m-%d')" || echo "No changes to commit"
          git push origin main
