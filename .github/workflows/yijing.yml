name: Daily Horoscopes Commit

on:
  schedule:
    - cron: '0 0 * * *'   # æ¯å¤© UTC 00:00ï¼ˆåŒ—äº¬æ—¶é—´ 08:00
  workflow_dispatch:

jobs:
  commit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout the repo
        uses: actions/checkout@v4

      - name: Generate mystic quote and fortune and append to README
        run: |
          # åŠ è½½64å¦æ•°æ®
          HEXAGRAMS=$(cat data/yijing_64gua.json)

          # éšæœºé€‰æ‹©ä¸€å¦ (0-63)
          HEXAGRAM_INDEX=$(( RANDOM % 64 ))
          
          # è·å–é€‰ä¸­çš„å¦ä¿¡æ¯
          HEXAGRAM=$(echo "$HEXAGRAMS" | jq -r ".[$HEXAGRAM_INDEX]")
          SYMBOL=$(echo "$HEXAGRAM" | jq -r '.symbol')
          NAME=$(echo "$HEXAGRAM" | jq -r '.name')
          TEXT=$(echo "$HEXAGRAM" | jq -r '.text')
          IMAGE=$(echo "$HEXAGRAM" | jq -r '.image')
          INTERPRETATION=$(echo "$HEXAGRAM" | jq -r '.interpretation')

          DATE=$(date '+%Y-%m-%d')

          # å°†é€‰ä¸­çš„å¦ä¿¡æ¯æ·»åŠ åˆ° README.md æ–‡ä»¶
          echo "" >> README.md
          echo "### ğŸŒŒ ä»Šæ—¥å¦è±¡ ($DATE)" >> README.md
          echo "å¦è±¡: $SYMBOL $NAME" >> README.md
          echo "å¦è¾: $TEXT" >> README.md
          echo "å¤§è±¡: $IMAGE" >> README.md
          echo "å¯ç¤º: $INTERPRETATION" >> README.md
          echo "" >> README.md

      - name: Commit and push changes
  env:
    TOKEN: ${{ secrets.GITHUB_TOKEN }}
  run: |
    # é…ç½® git ç”¨æˆ·ä¿¡æ¯
    git config --global user.name "CYXNBNBNB"
    git config --global user.email "cyxnbnbnb@gmail.com"
    
    # ä½¿ç”¨ GITHUB_TOKEN è®¾ç½®è¿œç¨‹ä»“åº“ URL
    git remote set-url origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}
    
    # æ·»åŠ æ›´æ”¹å¹¶æäº¤
    git add README.md
    git commit -m "ğŸŒŒ Mystic I Ching update on $(date '+%Y-%m-%d')" || echo "No changes to commit"
    
    # æ¨é€åˆ° main åˆ†æ”¯
    git push origin main

